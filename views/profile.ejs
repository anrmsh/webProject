<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <link rel="stylesheet" href="/css/profile.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <body>

    <header>
      <input type="checkbox" id="toggler" />
      <label for="toggler" class="fas fa-bars"></label>
      <a href="/" class="logo">BanquetBook<span>.</span></a>

      <nav class="navbar">
        <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="#about">–û –Ω–∞—Å</a>
        <a href="/halls">–ó–∞–ª—ã</a>
        <a href="#contact-info">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      </nav>

      <div class="icons">
        <a href="/favorites" class="fas fa-heart" title="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ"></a>
        <a href="/cart" class="fas fa-shopping-cart" title="–ë—Ä–æ–Ω–∏"></a>
        <% if (user) { %>
        <a href="/profile" class="fas fa-user" title="–ü—Ä–æ—Ñ–∏–ª—å"></a>
        <a href="/logout" class="fas fa-right-from-bracket" title="–í—ã–π—Ç–∏"></a>
        <% } else { %>
        <a href="/login" class="fas fa-user" title="–í–æ–π—Ç–∏"></a>
        <% } %>
      </div>
    </header>

    <main>
      <h2 class="heading">–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>

      <% if (user) { %>
      <section class="profile-info">
        <div class="box-container">

          <div class="box">
            <h3>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
            <p><strong>–ò–º—è:</strong> <%= user.first_name %></p>
            <p><strong>–§–∞–º–∏–ª–∏—è:</strong> <%= user.last_name %></p>

            <% if (client) { %>
            <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <%= client.phone %></p>
            <p>
              <strong>–¢–∏–ø –∫–ª–∏–µ–Ω—Ç–∞:</strong>
              <%= client.client_type === 'individual' ? '–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ' :
              '–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ' %>
            </p>
            <% } else { %>
            <p>–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω</p>
            <% } %>

            <a href="/edit-profile" class="btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
          </div>

          <div class="box">
            <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
            <% if (notifications && notifications.length > 0) { %> <%
            notifications.forEach(function(note) { %>
            <p><i class="fa-solid fa-bell"></i> <%= note %></p>
            <% }) %> <% } else { %>
            <p>–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
            <% } %>
          </div>
        </div>
      </section>

      <section class="banquets products">
        <h3 class="heading">–ú–æ–∏ –±—Ä–æ–Ω–∏</h3>

        <div class="filter-buttons">
          <button class="filter-btn" data-filter="all"><span>–í—Å–µ</span></button>
          <button class="filter-btn" data-filter="pending">
            <span>–û–∂–∏–¥–∞—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</span>
          </button>
          <button class="filter-btn" data-filter="confirmed">
            <span>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ</span>
          </button>
          <button class="filter-btn" data-filter="cancelled">
            <span>–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ</span>
          </button>
          <button class="filter-btn" data-filter="waiting_list">
            <span>–õ–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è</span>
          </button>
          <button class="filter-btn" data-filter="waiting_confirmation">
            <span>–ñ–¥—É—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</span>
          </button>
          <button class="filter-btn" data-filter="pastBookings">
            <span>–ü—Ä–æ—à–µ–¥—à–∏–µ</span>
          </button>
        </div>

        <div class="box-container">
          <% if (bookings && bookings.length > 0) { %>
          <%bookings.forEach(function(b) { 
            let statusText = ''; 
            let statusColor = ''; 
          if (b.status === 'pending') { 
            statusText ='–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è'; 
          statusColor = 'gray'; } 
          else if (b.status ==='confirmed') { 
            statusText = '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ'; statusColor = 'green';
          } else if (b.status === 'cancelled') { 
            statusText = '–û—Ç–º–µ–Ω–µ–Ω–æ';
          statusColor = 'red'; } 
          else if (b.status === 'waiting_list') {
          statusText = '–õ–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è'; 
          statusColor = 'gray'; } 
          else if
          (b.status === 'waiting_confirmation') { 
            statusText = '–ñ–¥—É—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è';
           statusColor = 'orange'; } %>

          <div
            class="box booking-box"
            data-status="<%= b.status %>"
            data-date="<%= b.date %>"
            data-id="<%= b.booking_id %>"
            data-last-rating="<%= b.userRating || 0 %>"
            data-hall-id="<%= b.banquetHall ? b.banquetHall.hall_id : '' %>"
          >
            <div class="image">
              <% if (b.banquetHall && b.banquetHall.image_path) { %>
              <img
                src="<%= b.banquetHall.image_path %>"
                alt="<%= b.banquetHall.hall_name %>"
              />
              <% } else { %>
              <img
                src="https://via.placeholder.com/300x230.png?text=Banquet+Hall"
                alt="Banquet Hall"
              />
              <% } %>
            </div>

            <div class="content">
              <h3>
                <%= b.banquetHall ? b.banquetHall.hall_name : '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è' %>
              </h3>
              <p><strong>–î–∞—Ç–∞:</strong> <%= b.date %></p>
              <p>
                <strong>–í—Ä–µ–º—è:</strong> <%= b.start_time %> - <%= b.end_time %>
              </p>

              <p><strong>–ì–æ—Å—Ç–µ–π:</strong> <%= b.guest_count %></p>

              <p>
                <strong>–°—Ç–∞—Ç—É—Å:</strong>
                <span class="status-text"><%= statusText %></span>
              </p>
              <% if (b.from_waiting_list) { %>
              <p class="new-booking">
                üåü –ù–æ–≤–∞—è –±—Ä–æ–Ω—å –∏–∑ –ª–∏—Å—Ç–∞ –æ–∂–∏–¥–∞–Ω–∏—è ‚Äî –≤—ã –º–æ–∂–µ—Ç–µ –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
              </p>
              <% } %> <% if (b.confirmable) { %>
              <button class="confirm-btn" data-id="<%= b.booking_id %>">
                –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
              </button>
              <% } %> <% if (b.editable && b.status !== 'cancelled') { %>
              <a href="/edit-booking/<%= b.booking_id %>" class="btn"
                >–ò–∑–º–µ–Ω–∏—Ç—å</a
              >

              <% } else { %>
              <p>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ (–º–µ–Ω–µ–µ 7 –¥–Ω–µ–π)</p>
              <% } %> <% if (b.status !== 'confirmed' && b.status !==
              'cancelled') { %>
              <button class="cancel-btn" data-id="<%= b.booking_id %>">
                –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å
              </button>
              <% } %>
            </div>
          </div>
          <% }) %> <% } else { %>
          <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</p>
          <% } %>

          <% if (waitingList && waitingList.length > 0) { %> <%
          waitingList.forEach(function(w) { %>
          <div
            class="box booking-box"
            data-status="waiting_list"
            data-date="<%= w.date %>"
            data-id="<%= w.waiting_id %>"
            data-position="<%= w.position %>"
          >
            <div class="image">
              <% if (w.banquetHall && w.banquetHall.image_path) { %>
              <img
                src="<%= w.banquetHall.image_path %>"
                alt="<%= w.banquetHall.hall_name %>"
              />
              <% } else { %>
              <img
                src="https://via.placeholder.com/300x230.png?text=Banquet+Hall"
                alt="Banquet Hall"
              />
              <% } %>
            </div>
            <div class="content">
              <h3>
                <%= w.banquetHall ? w.banquetHall.hall_name : '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è' %>
              </h3>
              <p><strong>–ñ–µ–ª–∞–µ–º–∞—è –¥–∞—Ç–∞:</strong> <%= w.date %></p>
              <p><strong>–ñ–µ–ª–∞–µ–º–æ–µ –≤—Ä–µ–º—è:</strong> <%= w.start_time %></p>
              <p><strong>–ü–æ–∑–∏—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏:</strong> <%= w.position %></p>
              <p>
                <strong>–°—Ç–∞—Ç—É—Å:</strong>
                <span class="status-text">–õ–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è</span>
              </p>
              <button class="cancel-wait-btn" data-id="<%= w.waiting_id %>">
                –û—Ç–∫–∞–∑–∞—Ç—å—Å—è
              </button>
            </div>
          </div>
          <% }) %> <% } %>

        </div>
      </section>
      <% } else { %>
      <p>–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã. <a href="/login">–í–æ–π—Ç–∏</a></p>
      <% } %>
    </main>

    <script src="/script/profileScript.js"></script>
  </body>
</html>
